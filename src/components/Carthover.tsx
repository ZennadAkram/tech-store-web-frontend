import { useEffect } from "react";
import { useCart } from "./CartIdContext";
import { X } from "lucide-react";
import { useNavigate } from "react-router-dom";

export function Carthover(){
     const { cart, fetchCart,removeitem } = useCart();
    const navigate=useNavigate();

    const calculatingTotal = () => {
      if (!cart) return 0;
      return cart.items.reduce((total, item) => {
        const itemTotal = item.version_details?.price ? Number(item.version_details.price) * item.quantity :Number(item.product_starting_price) * item.quantity
 
        
        return total + itemTotal;
      }, 0);
    };

    useEffect(()=>{
      fetchCart();

      console.log("the carts",cart)

    },[]);
    return (
        <>
        <div className="absolute shadow-2xl right-14 -top-3 w-0 h-0 border-l-[11px] border-r-[11px] border-b-[13px] border-l-transparent border-r-transparent border-b-white mx-auto"></div>
        {/* main container */}
        <div className=" bg-white w-full shadow-[0_10px_40px_rgba(0,0,0,0.5)] gap-2 flex items-center pb-9 pt-3 px-3 flex-col">
           <h1 className="font-bold text-xl">My Cart</h1>
           <span className="text-[#A2A6B0] text-sm"><span>{cart?.items.length}</span> item in cart</span>
          <button className="border-[3px] hover:bg-[#b6c4e0] font-bold w-full py-2 text-[#0156FF] border-[#0156FF] rounded-3xl">View or Edit Your Cart</button>
            <div className="flex h-52 overflow-y-auto flex-col w-full  gap-3">
               {cart?.items.map((item)=>{
                return (
                    <div className="flex flex-row items-center gap-3 w-full">
                      <span className="font-semibold text-lg">{item.quantity} <span className="font-semibold text-sm">x</span></span>
                      <img className="w-[60px] object-cover h-[60px]" src={item.version_details?.images?.[0]?.image ?? item.product_poster_image}
 alt="image" />
                      <div className="w-[45%]">
                       <span className="line-clamp-3 text-xs">
  {item.version_details?.features?.[0]?.description?.trim() 
    || "EX DISPLAY : MSI Pro 16 Flex-036AU 15.6 MULTITOUCH All-In-On..."}
</span>

                      </div>
                      <button onClick={() => {removeitem(item.id); fetchCart();}} className="rounded-full border-2 font-bold hover:bg-[#f3f4f6] border-[#CACDD8] text-[#CACDD8] p-1">
                      <X className="h-3 w-3"/>
                      </button>
                    </div>
                );
            })}
            </div>
            <h3 className="font-bold  text-[#CACDD8]">Subtotal: <span className="font-semibold text-lg text-black">${calculatingTotal().toFixed(2)}</span></h3>
             <button onClick={()=>navigate('/Checkout/')} className="bg-[#0156FF] text-white rounded-3xl w-full py-2 font-semibold"> Go to Checkout</button>
              <button className="bg-[#FFB800] flex flex-row justify-center gap-2 rounded-3xl w-full py-2 font-semibold"> Check out with

                <svg width="72" height="19" viewBox="0 0 72 19" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M55.6922 5.04541H52.04C51.8251 5.04541 51.6103 5.25594 51.5029 5.46646L49.999 14.7296C49.999 14.9401 50.1064 15.0454 50.3213 15.0454H52.2548C52.4696 15.0454 52.5771 14.9401 52.5771 14.7296L53.0067 12.098C53.0067 11.8875 53.2216 11.677 53.5438 11.677H54.7254C57.196 11.677 58.5925 10.5191 58.9147 8.2033C59.1296 7.25594 58.9147 6.41383 58.4851 5.88752C57.8406 5.3612 56.8738 5.04541 55.6922 5.04541ZM56.1219 8.51909C55.907 9.78225 54.9403 9.78225 53.9735 9.78225H53.329L53.7587 7.3612C53.7587 7.25594 53.8661 7.15067 54.0809 7.15067H54.2958C54.9403 7.15067 55.5848 7.15067 55.907 7.57173C56.1219 7.67699 56.1219 7.99278 56.1219 8.51909Z" fill="#139AD6"/>
<path d="M27.6562 4.64539H23.7705C23.542 4.64539 23.3134 4.87396 23.1991 5.10253L21.5991 15.1596C21.5991 15.3882 21.7134 15.5025 21.942 15.5025H23.7705C23.9991 15.5025 24.2277 15.2739 24.342 15.0454L24.7991 12.3025C24.7991 12.0739 25.0277 11.8454 25.3705 11.8454H26.6277C29.2562 11.8454 30.742 10.5882 31.0848 8.07395C31.3134 7.04538 31.0848 6.1311 30.6277 5.55967C29.942 4.98824 29.0277 4.64539 27.6562 4.64539ZM28.1134 8.4168C27.8848 9.78823 26.8562 9.78823 25.8277 9.78823H25.2563L25.7134 7.15967C25.7134 7.04538 25.8277 6.93109 26.0563 6.93109H26.2848C26.9705 6.93109 27.6562 6.93109 27.9991 7.38823C28.1134 7.50252 28.2277 7.84538 28.1134 8.4168Z" fill="#263B80"/>
<path d="M39.4277 8.30255H37.5992C37.4849 8.30255 37.2563 8.41683 37.2563 8.53112L37.142 9.10254L37.0277 8.87397C36.5706 8.30255 35.7706 8.07397 34.8563 8.07397C32.7992 8.07397 30.9706 9.67397 30.6277 11.8454C30.3992 12.9882 30.742 14.0168 31.3135 14.7025C31.8849 15.3882 32.6849 15.6168 33.7135 15.6168C35.4277 15.6168 36.342 14.5882 36.342 14.5882L36.2277 15.1597C36.2277 15.3882 36.342 15.5025 36.5706 15.5025H38.2849C38.5134 15.5025 38.742 15.274 38.8563 15.0454L39.8849 8.6454C39.7706 8.53112 39.542 8.30255 39.4277 8.30255ZM36.7992 11.9597C36.5706 12.9882 35.7706 13.7882 34.6277 13.7882C34.0563 13.7882 33.5992 13.5597 33.3706 13.3311C33.142 12.9882 33.0277 12.5311 33.0277 11.9597C33.142 10.9311 34.0563 10.1311 35.0849 10.1311C35.6563 10.1311 35.9992 10.3597 36.342 10.5883C36.6849 10.9311 36.7992 11.5025 36.7992 11.9597Z" fill="#263B80"/>
<path d="M67.509 8.28784H65.5488C65.4263 8.28784 65.1813 8.40905 65.1813 8.53026L65.0588 9.13632L64.9363 8.8939C64.4463 8.28784 63.5887 8.04541 62.6086 8.04541C60.4034 8.04541 58.4433 9.74238 58.0758 12.0454C57.8308 13.2575 58.1983 14.3484 58.8108 15.0757C59.4234 15.803 60.2809 16.0454 61.3835 16.0454C63.2212 16.0454 64.2012 14.9545 64.2012 14.9545L64.0787 15.5606C64.0787 15.803 64.2012 15.9242 64.4463 15.9242H66.2839C66.5289 15.9242 66.7739 15.6818 66.8964 15.4393L67.999 8.65147C67.8765 8.53026 67.754 8.28784 67.509 8.28784ZM64.6913 12.1666C64.4463 13.2575 63.5887 14.106 62.3636 14.106C61.751 14.106 61.261 13.8636 61.016 13.6212C60.771 13.2575 60.6485 12.7727 60.6485 12.1666C60.771 11.0757 61.751 10.2272 62.8536 10.2272C63.4662 10.2272 63.8337 10.4697 64.2012 10.7121C64.6913 11.0757 64.8138 11.6818 64.6913 12.1666Z" fill="#139AD6"/>
<path d="M49.7127 8.04541H47.7889C47.5626 8.04541 47.4494 8.16035 47.3363 8.27529L44.8466 12.1833L43.715 8.50518C43.6018 8.27529 43.4887 8.16035 43.1492 8.16035H41.3385C41.1122 8.16035 40.999 8.39024 40.999 8.62012L43.036 14.7121L41.1122 17.4707C40.999 17.7006 41.1122 18.0454 41.3385 18.0454H43.1492C43.3755 18.0454 43.4887 17.9305 43.6018 17.8155L49.8259 8.73507C50.1654 8.39024 49.9391 8.04541 49.7127 8.04541Z" fill="#263B80"/>
<path d="M69.5546 5.32128L67.999 15.6995C67.999 15.9301 68.1101 16.0454 68.3324 16.0454H69.8879C70.1101 16.0454 70.3324 15.8148 70.4435 15.5842L71.999 5.43659C71.999 5.20596 71.8879 5.09065 71.6657 5.09065H69.8879C69.7768 4.97533 69.6657 5.09065 69.5546 5.32128Z" fill="#139AD6"/>
<path d="M13.0628 1.39752C12.2676 0.496113 10.7908 0.0454102 8.74608 0.0454102H3.06617C2.72538 0.0454102 2.38458 0.383437 2.27099 0.721465L-0.000976562 15.482C-0.000976562 15.8201 0.22622 16.0454 0.453416 16.0454H3.97496L4.88374 10.5243V10.7496C4.99734 10.4116 5.33814 10.0736 5.67893 10.0736H7.3829C10.6772 10.0736 13.1764 8.72147 13.9716 5.00316C13.9716 4.89048 13.9716 4.7778 13.9716 4.66513C13.858 4.66513 13.858 4.66513 13.9716 4.66513C14.0852 3.20034 13.858 2.29893 13.0628 1.39752Z" fill="#263B80"/>
<path d="M13.711 4.04541C13.711 4.16306 13.711 4.28071 13.711 4.39835C12.9556 8.39835 10.5816 9.69247 7.45217 9.69247H5.83351C5.50977 9.69247 5.18604 10.0454 5.07813 10.3984L3.99902 17.5748C3.99902 17.8101 4.10693 18.0454 4.43067 18.0454H7.23635C7.56008 18.0454 7.88381 17.8101 7.88381 17.4572V17.3395L8.42337 13.6925V13.4572C8.42337 13.1042 8.7471 12.8689 9.07083 12.8689H9.50247C12.2002 12.8689 14.3585 11.6925 14.898 8.16306C15.1138 6.75129 15.0059 5.45717 14.3585 4.63365C14.2505 4.39835 14.0347 4.16306 13.711 4.04541Z" fill="#139AD6"/>
<path d="M12.999 4.39541C12.8879 4.39541 12.7768 4.27874 12.6657 4.27874C12.5546 4.27874 12.4435 4.27874 12.3324 4.16208C11.8879 4.04541 11.4435 4.04541 10.8879 4.04541H6.55458C6.44347 4.04541 6.33236 4.04541 6.22125 4.16208C5.99902 4.27874 5.88791 4.51208 5.88791 4.74541L4.99902 10.8121V11.0454C5.11013 10.6954 5.44347 10.3454 5.7768 10.3454H7.44347C10.6657 10.3454 13.1101 8.94541 13.8879 5.09541C13.8879 4.97874 13.8879 4.86208 13.999 4.74541C13.7768 4.62874 13.6657 4.51208 13.4435 4.51208C13.1101 4.39541 13.1101 4.39541 12.999 4.39541Z" fill="#232C65"/>
</svg>

              </button>
  
  

</div>

        </>
    );
}